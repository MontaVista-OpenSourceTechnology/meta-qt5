From 47fb6b3e94b91e43f9ac47333434afa4d5d712f7 Mon Sep 17 00:00:00 2001
From: Vivek Kumbhar <vkumbhar@mvista.com>
Date: Wed, 24 Jul 2024 12:56:52 +0000
Subject: [PATCH] CVE-2021-28025

---
 src/svg/qsvghandler.cpp | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/svg/qsvghandler.cpp b/src/svg/qsvghandler.cpp
index afdecdc..3349e84 100644
--- a/src/svg/qsvghandler.cpp
+++ b/src/svg/qsvghandler.cpp
@@ -668,6 +668,8 @@ static qreal toDouble(const QChar *&str)
             val = -val;
     } else {
         val = QByteArray::fromRawData(temp, pos).toDouble();
+        // Do not tolerate values too wild to be represented normally by floats
+        if (qFpClassify(float(val)) != FP_NORMAL)
     }
     return val;

@@ -3033,6 +3035,8 @@ static QSvgStyleProperty *createRadialGradientNode(QSvgNode *node,
         ncy = toDouble(cy);
     if (!r.isEmpty())
         nr = toDouble(r);
+    if (nr < 0.5)
+        nr = 0.5;

     qreal nfx = ncx;
     if (!fx.isEmpty())
--
2.24.4
